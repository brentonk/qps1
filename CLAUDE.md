# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Quarto book containing course notes for PSCI 2300 (Quantitative Political Science I: Computing) at Vanderbilt University. The course teaches introductory data analysis with R to political science students, focusing on practical skills without deep mathematical theory.

The notes are published as a web book at <https://bkenkel.com/qps1> using GitHub Pages.

## Building and Rendering

### Render the book
```bash
quarto render
```

This builds the book to the `_book/` directory. The render process:
1. Executes R code in all `.qmd` files (with `freeze: auto` caching enabled)
2. Generates HTML output
3. Runs the post-render script `make_student_versions.py` to create student versions
4. Copies the `data/` directory into `_book/`

### Preview while editing
```bash
quarto preview
```

This starts a local server with live reload.

### Render a single chapter
```bash
quarto render intro_r.qmd
```

### Clear the freeze cache
```bash
quarto render --cache-refresh
```

Use this if you've modified R code and want to force re-execution.

## Repository Structure

### Chapter files
The main content lives in `.qmd` (Quarto Markdown) files at the repository root:
- `index.qmd` - Preface
- `intro_r.qmd` - Introduction to R, RStudio, Quarto
- `data_wrangling.qmd` - Data manipulation with tidyverse
- `univariate_analysis.qmd` - Central tendency, spread, distributions
- `data_visualization.qmd` - ggplot2 and visualization
- `correlation_regression.qmd` - Regression analysis
- `simulation_resampling.qmd` - Random number generation, bootstrap
- `text_analysis.qmd` - Text processing and analysis
- `using_chatgpt.qmd` - Appendix on AI prompting
- `data_sources.qmd` - Appendix documenting datasets
- `references.qmd` - Bibliography

The chapter order is defined in `_quarto.yml` under `book.chapters`.

### Student versions
The `make_student_versions.py` script generates standalone PDF-renderable versions of each chapter in `student_versions/`. These versions:
- Comment out images not generated by code chunks
- Remove `.aside` blocks (which don't render well in PDF)
- Add a YAML header with PDF output configuration
- Remove the initial chapter header and promote all other headers by one level

This script runs automatically as a post-render hook (see `_quarto.yml`).

### Data directory
`data/` contains CSV files used throughout the course:
- `anes_2020.csv` - American National Election Studies data
- `candidates.csv` - Candidate information
- `county_pres.csv` - County-level presidential election results
- `crises.csv` - International crisis data
- `fed_papers.csv` - Federalist Papers text
- `gss_2024.csv` - General Social Survey subset
- `military.csv` - Military spending data
- `pres_polls_2024.csv` - Presidential polling data
- `pres_results_2024.csv` - Presidential election results
- `spending.csv` - Campaign spending data
- `turnout.csv` - Voter turnout data
- `wdi.csv` - World Development Indicators

These files are copied to `_book/data/` during rendering so they're accessible in the published book.

### Configuration
- `_quarto.yml` - Main Quarto configuration defining book structure, theme, and rendering options
- `qps1.scss` - Custom styling for the book
- `.Rprofile` - Sets R console width to 72 characters
- `references.bib` - BibTeX bibliography

### Build artifacts
- `_book/` - Rendered HTML output (git-ignored, deployed to GitHub Pages)
- `_freeze/` - Cached execution results for chapters
- `*_cache/` - Individual chapter caches (e.g., `simulation_resampling_cache/`)
- `*_files/` - Generated figures and resources

## Code Style and Conventions

### R code in chapters
- Uses tidyverse extensively, particularly dplyr and ggplot2
- Loads data with `read_csv()` from the `data/` directory
- Code is meant to be pedagogical, not necessarily production-ready
- Examples use real political science datasets

### Quarto/Markdown conventions
- Chapters start with `# Chapter Title {#sec-chapter-id}`
- Cross-references use `@sec-chapter-id` syntax
- Important concepts are marked with `[concept]{.concept}` spans
- Aside blocks use `::: {.aside}` syntax
- Code chunks are standard R chunks with options like `#| echo: false`
- Line breaks after every sentence (author preference for version control)

## Common Modifications

### Adding a new chapter
1. Create `new_chapter.qmd` at repository root
2. Add it to `book.chapters` in `_quarto.yml`
3. Use the pattern: `# Chapter Title {#sec-chapter-id}` for the header
4. Add to the exclusion list in `make_student_versions.py` if it shouldn't generate a student version

### Adding new data
1. Place CSV in `data/` directory
2. Document the data source and variables in `data_sources.qmd`
3. The data will be automatically copied to `_book/data/` on render

### Modifying the theme
- Edit `qps1.scss` for custom styles
- Base theme is "lumen" (see `_quarto.yml`)
- Monospace font is set to 'Iosevka Web'

## Deployment

The book is deployed via GitHub Actions (`.github/workflows/static.yml`) which:
1. Triggers on pushes to the `main` branch
2. Uploads the `_book/` directory to GitHub Pages
3. Deploys to <https://bkenkel.com/qps1>

Note: The workflow assumes `_book/` already contains the rendered content, so you must run `quarto render` locally before pushing.

## License

Content is licensed under CC BY-NC-SA 4.0 (Creative Commons Attribution-NonCommercial-ShareAlike 4.0).
